<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ============================================================
         TOBY NITRO'S BLOG
         A zero-dependency, self-hosted blog engine
         
         HOW THIS WORKS:
         1. Write posts as .md files in the /posts folder
         2. Add each post to posts.json (one line per post)
         3. Push to Netlify (or any static host)
         4. That's it!
         
         The URL structure uses hash routing:
         - tobynitro.com/           → shows post list
         - tobynitro.com/#my-post   → shows that post
    ============================================================ -->
    
    <title>Toby Nitro</title>
    
    <!-- ============================================================
         FAVICON
         Replace this with your own. You can use an emoji, SVG, or .ico file.
         To use an image file instead, replace the href with: href="/favicon.ico"
    ============================================================ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
    
    <style>
        /* ============================================================
           CSS VARIABLES - EDIT THESE TO CHANGE YOUR BLOG'S LOOK
           
           This is the easiest place to customise colors, fonts, and spacing.
           Change these values and the whole site updates.
        ============================================================ */
        :root {
            /* -- COLORS -- */
            --color-bg: #ffffff;              /* Page background */
            --color-text: #1a1a1a;            /* Main text color */
            --color-text-muted: #666666;      /* Secondary text (dates, meta) */
            --color-link: #0066cc;            /* Link color */
            --color-link-hover: #004499;      /* Link hover color */
            --color-border: #e0e0e0;          /* Borders and dividers */
            --color-code-bg: #f5f5f5;         /* Code block background */
            --color-accent: #0066cc;          /* Accent color for highlights */
            
            /* -- TYPOGRAPHY -- */
            --font-body: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            --font-heading: var(--font-body); /* Same as body, change if you want different */
            --font-mono: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            
            --font-size-base: 18px;           /* Base font size */
            --font-size-small: 14px;          /* Small text */
            --font-size-h1: 2rem;             /* Post titles */
            --font-size-h2: 1.5rem;           /* Section headings */
            --font-size-h3: 1.25rem;          /* Sub-section headings */
            
            --line-height: 1.7;               /* Line spacing for readability */
            
            /* -- LAYOUT -- */
            --content-width: 600px;           /* Max width of content */
            --spacing-unit: 1.5rem;           /* Base spacing unit */
        }
        
        /* ============================================================
           DARK MODE (optional)
           
           Uncomment this block to enable automatic dark mode based on
           the user's system preference. Or delete it if you don't want it.
        ============================================================ */
        /*
        @media (prefers-color-scheme: dark) {
            :root {
                --color-bg: #1a1a1a;
                --color-text: #e0e0e0;
                --color-text-muted: #999999;
                --color-link: #6db3f2;
                --color-link-hover: #9ecbf7;
                --color-border: #333333;
                --color-code-bg: #2d2d2d;
            }
        }
        */
        
        /* ============================================================
           BASE STYLES
           You probably don't need to edit below this line unless you
           want to change the actual layout structure.
        ============================================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: var(--font-size-base);
        }
        
        body {
            font-family: var(--font-body);
            line-height: var(--line-height);
            color: var(--color-text);
            background-color: var(--color-bg);
            padding: var(--spacing-unit);
        }
        
        /* ============================================================
           LAYOUT CONTAINER
           Centers content and constrains to max-width
        ============================================================ */
        .container {
            max-width: var(--content-width);
            margin: 0 auto;
            padding: var(--spacing-unit) 0;
        }
        
        /* ============================================================
           HEADER
           Edit the HTML below to change your logo/title
        ============================================================ */
        .site-header {
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 2);
            padding-bottom: var(--spacing-unit);
            border-bottom: 1px solid var(--color-border);
        }
        
        .site-logo {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            /* If using an image logo, style it here */
        }
        
        .site-title {
            font-family: var(--font-heading);
            font-size: var(--font-size-h1);
            font-weight: 700;
            color: var(--color-text);
            text-decoration: none;
        }
        
        .site-title:hover {
            color: var(--color-link);
        }
        
        .site-tagline {
            color: var(--color-text-muted);
            font-size: var(--font-size-small);
            margin-top: 0.25rem;
        }
        
        /* ============================================================
           POST LIST (homepage)
        ============================================================ */
        .post-list {
            list-style: none;
        }
        
        .post-list-item {
            padding: var(--spacing-unit) 0;
            border-bottom: 1px solid var(--color-border);
        }
        
        .post-list-item:last-child {
            border-bottom: none;
        }
        
        .post-list-link {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-text);
            text-decoration: none;
        }
        
        .post-list-link:hover {
            color: var(--color-link);
        }
        
        .post-list-date {
            display: block;
            color: var(--color-text-muted);
            font-size: var(--font-size-small);
            margin-top: 0.25rem;
        }
        
        /* ============================================================
           SINGLE POST VIEW
        ============================================================ */
        .post-header {
            margin-bottom: calc(var(--spacing-unit) * 1.5);
        }
        
        .post-title {
            font-family: var(--font-heading);
            font-size: var(--font-size-h1);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .post-date {
            color: var(--color-text-muted);
            font-size: var(--font-size-small);
        }
        
        /* ============================================================
           POST CONTENT - Markdown rendered styles
        ============================================================ */
        .post-content h1 { font-size: var(--font-size-h1); margin: 2rem 0 1rem; }
        .post-content h2 { font-size: var(--font-size-h2); margin: 1.75rem 0 0.75rem; }
        .post-content h3 { font-size: var(--font-size-h3); margin: 1.5rem 0 0.5rem; }
        
        .post-content p {
            margin-bottom: var(--spacing-unit);
        }
        
        .post-content a {
            color: var(--color-link);
            text-decoration: underline;
        }
        
        .post-content a:hover {
            color: var(--color-link-hover);
        }
        
        .post-content strong {
            font-weight: 600;
        }
        
        .post-content em {
            font-style: italic;
        }
        
        .post-content ul,
        .post-content ol {
            margin-bottom: var(--spacing-unit);
            padding-left: 1.5rem;
        }
        
        .post-content li {
            margin-bottom: 0.5rem;
        }
        
        .post-content blockquote {
            border-left: 3px solid var(--color-accent);
            padding-left: var(--spacing-unit);
            margin: var(--spacing-unit) 0;
            color: var(--color-text-muted);
            font-style: italic;
        }
        
        .post-content code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }
        
        .post-content pre {
            background-color: var(--color-code-bg);
            padding: var(--spacing-unit);
            border-radius: 4px;
            overflow-x: auto;
            margin-bottom: var(--spacing-unit);
        }
        
        .post-content pre code {
            background: none;
            padding: 0;
        }
        
        .post-content hr {
            border: none;
            border-top: 1px solid var(--color-border);
            margin: calc(var(--spacing-unit) * 2) 0;
        }
        
        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }
        
        /* ============================================================
           NAVIGATION (back/next)
        ============================================================ */
        .post-nav {
            display: flex;
            justify-content: space-between;
            margin-top: calc(var(--spacing-unit) * 2);
            padding-top: var(--spacing-unit);
            border-top: 1px solid var(--color-border);
            font-size: var(--font-size-small);
        }
        
        .post-nav a {
            color: var(--color-link);
            text-decoration: none;
        }
        
        .post-nav a:hover {
            text-decoration: underline;
        }
        
        .post-nav-prev::before {
            content: '← ';
        }
        
        .post-nav-next::after {
            content: ' →';
        }
        
        /* Empty placeholder to maintain layout */
        .post-nav-placeholder {
            visibility: hidden;
        }
        
        /* ============================================================
           FOOTER
        ============================================================ */
        .site-footer {
            margin-top: calc(var(--spacing-unit) * 2);
            padding-top: var(--spacing-unit);
            border-top: 1px solid var(--color-border);
            text-align: center;
            color: var(--color-text-muted);
            font-size: var(--font-size-small);
        }
        
        /* ============================================================
           LOADING & ERROR STATES
        ============================================================ */
        .loading {
            text-align: center;
            color: var(--color-text-muted);
            padding: calc(var(--spacing-unit) * 2);
        }
        
        .error {
            text-align: center;
            color: #cc0000;
            padding: calc(var(--spacing-unit) * 2);
        }
    </style>
</head>
<body>
    <div class="container">
        
        <!-- ============================================================
             HEADER - EDIT THIS TO CUSTOMISE YOUR BLOG'S HEADER
             
             Options:
             1. Emoji logo (current): Just change the emoji
             2. Image logo: Replace the span with <img src="/logo.png" alt="Logo" class="site-logo">
             3. Text only: Delete the site-logo span entirely
        ============================================================ -->
        <header class="site-header">
            <div class="site-logo">⚡</div>
            <a href="/" class="site-title">Toby Nitro</a>
            <p class="site-tagline">Daily thoughts and experiments</p>
        </header>
        
        <!-- Main content area - populated by JavaScript -->
        <main id="content">
            <div class="loading">Loading...</div>
        </main>
        
        <!-- ============================================================
             FOOTER - EDIT THIS TO CUSTOMISE
        ============================================================ -->
        <footer class="site-footer">
            <p>© 2025 Toby Nitro</p>
        </footer>
        
    </div>
    
    <script>
    /* ============================================================
       BLOG ENGINE
       
       This is the JavaScript that powers everything.
       You probably don't need to edit this unless you want to
       add features.
       
       How it works:
       1. Loads posts.json to get the list of posts
       2. Checks the URL hash to decide what to show
       3. Either shows the post list or fetches/renders a single post
    ============================================================ */
    
    (function() {
        'use strict';
        
        // ============================================================
        // CONFIGURATION
        // ============================================================
        const CONFIG = {
            postsFile: '/posts.json',      // Where the post manifest lives
            postsDir: '/posts/',           // Where .md files live
            dateFormat: {                  // How dates are displayed
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }
        };
        
        // Store for loaded posts data
        let postsData = null;
        
        // ============================================================
        // MARKDOWN PARSER
        // 
        // A tiny, zero-dependency markdown parser.
        // Handles: headings, bold, italic, links, images, code,
        //          lists, blockquotes, horizontal rules, paragraphs
        // 
        // For a daily blog, this covers 99% of what you'll write.
        // If you need more features, you can swap this out for
        // marked.js by adding: <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js">
        // and replacing parseMarkdown(text) with marked.parse(text)
        // ============================================================
        function parseMarkdown(text) {
            // Normalize line endings
            text = text.replace(/\r\n/g, '\n');
            
            // Store code blocks to protect them from other parsing
            const codeBlocks = [];
            text = text.replace(/```(\w*)\n([\s\S]*?)```/g, (match, lang, code) => {
                codeBlocks.push(`<pre><code class="language-${lang}">${escapeHtml(code.trim())}</code></pre>`);
                return `%%CODEBLOCK${codeBlocks.length - 1}%%`;
            });
            
            // Inline code (protect from other parsing)
            const inlineCodes = [];
            text = text.replace(/`([^`]+)`/g, (match, code) => {
                inlineCodes.push(`<code>${escapeHtml(code)}</code>`);
                return `%%INLINECODE${inlineCodes.length - 1}%%`;
            });
            
            // Split into lines for block-level parsing
            const lines = text.split('\n');
            let html = '';
            let inList = false;
            let listType = '';
            let inBlockquote = false;
            let blockquoteContent = [];
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];
                
                // Headings
                if (line.match(/^#{1,6}\s/)) {
                    if (inList) { html += `</${listType}>`; inList = false; }
                    if (inBlockquote) { html += `<blockquote><p>${parseInline(blockquoteContent.join(' '))}</p></blockquote>`; inBlockquote = false; blockquoteContent = []; }
                    const level = line.match(/^(#+)/)[1].length;
                    const content = line.replace(/^#+\s*/, '');
                    html += `<h${level}>${parseInline(content)}</h${level}>\n`;
                    continue;
                }
                
                // Horizontal rule
                if (line.match(/^(-{3,}|\*{3,}|_{3,})$/)) {
                    if (inList) { html += `</${listType}>`; inList = false; }
                    if (inBlockquote) { html += `<blockquote><p>${parseInline(blockquoteContent.join(' '))}</p></blockquote>`; inBlockquote = false; blockquoteContent = []; }
                    html += '<hr>\n';
                    continue;
                }
                
                // Blockquote
                if (line.match(/^>\s?/)) {
                    if (inList) { html += `</${listType}>`; inList = false; }
                    inBlockquote = true;
                    blockquoteContent.push(line.replace(/^>\s?/, ''));
                    continue;
                } else if (inBlockquote) {
                    html += `<blockquote><p>${parseInline(blockquoteContent.join(' '))}</p></blockquote>\n`;
                    inBlockquote = false;
                    blockquoteContent = [];
                }
                
                // Unordered list
                if (line.match(/^[\*\-]\s/)) {
                    if (!inList || listType !== 'ul') {
                        if (inList) html += `</${listType}>`;
                        html += '<ul>';
                        inList = true;
                        listType = 'ul';
                    }
                    html += `<li>${parseInline(line.replace(/^[\*\-]\s/, ''))}</li>`;
                    continue;
                }
                
                // Ordered list
                if (line.match(/^\d+\.\s/)) {
                    if (!inList || listType !== 'ol') {
                        if (inList) html += `</${listType}>`;
                        html += '<ol>';
                        inList = true;
                        listType = 'ol';
                    }
                    html += `<li>${parseInline(line.replace(/^\d+\.\s/, ''))}</li>`;
                    continue;
                }
                
                // Close list if we hit a non-list line
                if (inList && line.trim() === '') {
                    html += `</${listType}>\n`;
                    inList = false;
                    continue;
                }
                
                // Code block placeholder (restore later)
                if (line.match(/%%CODEBLOCK\d+%%/)) {
                    if (inList) { html += `</${listType}>`; inList = false; }
                    html += line + '\n';
                    continue;
                }
                
                // Paragraph
                if (line.trim() !== '') {
                    if (inList) { html += `</${listType}>`; inList = false; }
                    html += `<p>${parseInline(line)}</p>\n`;
                }
            }
            
            // Close any open elements
            if (inList) html += `</${listType}>`;
            if (inBlockquote) html += `<blockquote><p>${parseInline(blockquoteContent.join(' '))}</p></blockquote>`;
            
            // Restore code blocks
            codeBlocks.forEach((block, i) => {
                html = html.replace(`%%CODEBLOCK${i}%%`, block);
            });
            
            // Restore inline code
            inlineCodes.forEach((code, i) => {
                html = html.replace(`%%INLINECODE${i}%%`, code);
            });
            
            return html;
        }
        
        // Parse inline elements (bold, italic, links, images)
        function parseInline(text) {
            // Images: ![alt](src)
            text = text.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">');
            
            // Links: [text](url)
            text = text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>');
            
            // Bold: **text** or __text__
            text = text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/__([^_]+)__/g, '<strong>$1</strong>');
            
            // Italic: *text* or _text_
            text = text.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            text = text.replace(/_([^_]+)_/g, '<em>$1</em>');
            
            return text;
        }
        
        // Escape HTML entities
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ============================================================
        // DATE FORMATTING
        // ============================================================
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB', CONFIG.dateFormat);
        }
        
        // ============================================================
        // ROUTING
        // Determines what to show based on URL hash
        // ============================================================
        function getRoute() {
            const hash = window.location.hash.slice(1); // Remove the #
            return hash || null; // null means show homepage
        }
        
        // ============================================================
        // RENDER POST LIST (homepage)
        // ============================================================
        function renderPostList(posts) {
            if (posts.length === 0) {
                return '<p class="loading">No posts yet. Add your first post!</p>';
            }
            
            const items = posts.map(post => `
                <li class="post-list-item">
                    <a href="#${post.slug}" class="post-list-link">${escapeHtml(post.title)}</a>
                    <span class="post-list-date">${formatDate(post.date)}</span>
                </li>
            `).join('');
            
            return `<ul class="post-list">${items}</ul>`;
        }
        
        // ============================================================
        // RENDER SINGLE POST
        // ============================================================
        function renderPost(post, content, prevPost, nextPost) {
            const nav = `
                <nav class="post-nav">
                    ${prevPost 
                        ? `<a href="#${prevPost.slug}" class="post-nav-prev">${escapeHtml(prevPost.title)}</a>`
                        : '<span class="post-nav-placeholder">Previous</span>'
                    }
                    ${nextPost 
                        ? `<a href="#${nextPost.slug}" class="post-nav-next">${escapeHtml(nextPost.title)}</a>`
                        : '<span class="post-nav-placeholder">Next</span>'
                    }
                </nav>
            `;
            
            return `
                <article>
                    <header class="post-header">
                        <h1 class="post-title">${escapeHtml(post.title)}</h1>
                        <time class="post-date">${formatDate(post.date)}</time>
                    </header>
                    <div class="post-content">
                        ${parseMarkdown(content)}
                    </div>
                    ${nav}
                </article>
            `;
        }
        
        // ============================================================
        // FETCH AND DISPLAY CONTENT
        // ============================================================
        async function loadPosts() {
            if (postsData) return postsData;
            
            try {
                const response = await fetch(CONFIG.postsFile);
                if (!response.ok) throw new Error('Could not load posts');
                postsData = await response.json();
                // Sort by date, newest first
                postsData.sort((a, b) => new Date(b.date) - new Date(a.date));
                return postsData;
            } catch (error) {
                console.error('Error loading posts:', error);
                throw error;
            }
        }
        
        async function loadPostContent(slug) {
            try {
                const response = await fetch(`${CONFIG.postsDir}${slug}.md`);
                if (!response.ok) throw new Error('Post not found');
                return await response.text();
            } catch (error) {
                console.error('Error loading post:', error);
                throw error;
            }
        }
        
        async function render() {
            const content = document.getElementById('content');
            const slug = getRoute();
            
            try {
                const posts = await loadPosts();
                
                if (!slug) {
                    // Show post list
                    content.innerHTML = renderPostList(posts);
                    document.title = 'Toby Nitro'; // Change to your blog name
                } else {
                    // Find and show single post
                    const postIndex = posts.findIndex(p => p.slug === slug);
                    
                    if (postIndex === -1) {
                        content.innerHTML = '<p class="error">Post not found</p>';
                        return;
                    }
                    
                    const post = posts[postIndex];
                    const postContent = await loadPostContent(slug);
                    
                    // Get prev/next posts (remember: array is newest-first)
                    const prevPost = posts[postIndex + 1] || null; // Older post
                    const nextPost = posts[postIndex - 1] || null; // Newer post
                    
                    content.innerHTML = renderPost(post, postContent, prevPost, nextPost);
                    document.title = `${post.title} — Toby Nitro`; // Change to your blog name
                    
                    // Scroll to top when viewing a post
                    window.scrollTo(0, 0);
                }
            } catch (error) {
                content.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        }
        
        // ============================================================
        // INITIALISE
        // ============================================================
        
        // Re-render when URL hash changes
        window.addEventListener('hashchange', render);
        
        // Initial render
        render();
        
    })();
    </script>
</body>
</html>
